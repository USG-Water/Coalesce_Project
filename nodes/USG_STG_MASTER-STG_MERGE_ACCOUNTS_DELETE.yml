fileVersion: 1
id: a9a79d36-17eb-4252-a802-c6874aa733a5
name: STG_MERGE_ACCOUNTS_DELETE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: Merge HubSpot Companies â†’ Oracle Salescloud Organizations
  isMultisource: false
  locationName: USG_STG_MASTER
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2805f9ef-e325-4e21-a04c-e7f2ed65078e
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: VARCHAR
        description: ""
        name: ACCOUNT_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: MD5(COALESCE("STG_OSC_ACCOUNT"."PARTY_ID"::VARCHAR, '') || '|' || COALESCE("STG_HUBSPOT_COMPANIES"."COMPANY_ID"::VARCHAR, '') || '|' || COALESCE("STG_EBS_CUST_ACCOUNTS"."PARTY_ID"::VARCHAR, ''))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb384be7-75ba-408e-a1c8-12d226ea5e09
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: NUMBER(38,0)
        description: OSC - PARTY_ID
        name: OSC_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 61372e92-bcd8-4738-8ab8-59add39139b0
                stepCounter: 01b7102b-ee82-491c-a933-a7c409ea5f5e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 97b5a236-533c-4735-ad84-b083faabfecf
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: NUMBER(38,0)
        description: EBS - PARTY_ID
        name: EBS_PARTY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1ad8da84-501f-4fab-868e-93b843e4dc2c
                stepCounter: 7adca5ad-7edb-466f-a1c5-3b51140bb18f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 593db150-5fa8-40f7-b3bd-b7d77295c834
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: NUMBER(38,0)
        description: EBS - CUST_ACCOUNT_ID
        name: EBS_CUSTOMER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 16cff5b2-148e-41e7-8400-8d919ef4f9e2
                stepCounter: 7adca5ad-7edb-466f-a1c5-3b51140bb18f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 493fffab-3e65-48c8-bda5-f4960430cad4
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: NUMBER(38,0)
        description: HubSpot - COMPANY_ID
        name: HUBSPOT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0ca5d12b-0320-47f7-b92a-aca3b3b3aa39
                stepCounter: a485b708-19e1-449a-bb15-89f3638f951e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec900e72-7f02-4e2d-ac53-a5dfa4bfa590
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: VARCHAR
        description: Merged Address ID
        name: ADDRESS_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: COALESCE("STG_ADDRESSES_OSC"."ADDRESS_ID", "STG_ADDRESSES_HUBSPOT"."ADDRESS_ID")
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ddfb839c-39e3-42fa-95b4-1e2896b6e3f6
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: NUMBER(38,0)
        description: OSC - PREFERRED_CONTACT_PERSON_ID
        name: PREFERRED_CONTACT_PERSON_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 099e18a8-0dee-4540-93c1-6f571eb157e4
                stepCounter: 01b7102b-ee82-491c-a933-a7c409ea5f5e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d23bba99-40e7-4d53-b718-618bf6447c02
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: VARCHAR(256)
        description: |-
          OSC - PARTY_NAME
          HubSpot - COMPANY_NAME
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: TRIM(UPPER(COALESCE("STG_OSC_ACCOUNT"."PARTY_NAME", "STG_HUBSPOT_COMPANIES"."COMPANY_NAME", "STG_EBS_CUST_ACCOUNTS"."PARTY_NAME")))
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 27a20724-59f6-418e-8a9d-45f75d5eb12f
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: VARCHAR(2048)
        defaultValue: ""
        description: |-
          OSC - COMMENTS
          HubSpot - DESCRIPTION
        keyColumnType: None
        name: DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: COALESCE("STG_OSC_ACCOUNT"."COMMENTS", "STG_HUBSPOT_COMPANIES"."DESCRIPTION")
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 230327a7-3c6b-454c-a2c6-0c411416a4fe
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: VARCHAR(256)
        defaultValue: ""
        description: HubSpot - INDUSTRY
        keyColumnType: None
        name: INDUSTRY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 211391b0-a693-4e80-846f-25dd169b0ada
                stepCounter: a485b708-19e1-449a-bb15-89f3638f951e
            transform: ""
        systemColumnType: None
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9a4ea0b-eee5-4eab-a79f-d49eb6f677c9
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: VARCHAR(256)
        description: OSC - URL
        name: URL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 22936013-6fed-49af-9c98-831fb7329a0c
                stepCounter: 01b7102b-ee82-491c-a933-a7c409ea5f5e
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8d25d8c4-0ad6-4ce5-8c8b-b97dcd1b24f8
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: BOOLEAN
        description: |-
          OSC - INTERNAL_FLAG
          HubSpot - (FALSE)
        name: INTERNAL_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: COALESCE("STG_OSC_ACCOUNT"."INTERNAL_FLAG", FALSE)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 717ae6a2-a2d8-4ece-99dc-5f66c9311a24
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: BOOLEAN
        description: |-
          OSC - ACTIVE_FLAG
          HubSpot - (TRUE)
        name: ACTIVE_FLAG
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: COALESCE("STG_OSC_ACCOUNT"."ACTIVE_FLAG", TRUE)
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: c3391e4b-56af-4938-960f-660f41e22a99
          stepCounter: a9a79d36-17eb-4252-a802-c6874aa733a5
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: Defines which source system the record belongs to
        keyColumnType: None
        name: SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              CASE
                  WHEN "STG_OSC_ACCOUNT"."PARTY_ID" IS NOT NULL
                       AND "STG_HUBSPOT_COMPANIES"."COMPANY_ID" IS NULL
                       AND "STG_EBS_CUST_ACCOUNTS"."PARTY_ID" IS NULL
                  THEN 'OSC'
              
                  WHEN "STG_OSC_ACCOUNT"."PARTY_ID" IS NULL
                       AND "STG_HUBSPOT_COMPANIES"."COMPANY_ID" IS NOT NULL
                       AND "STG_EBS_CUST_ACCOUNTS"."PARTY_ID" IS NULL
                  THEN 'HubSpot'
              
                  WHEN "STG_OSC_ACCOUNT"."PARTY_ID" IS NULL
                       AND "STG_HUBSPOT_COMPANIES"."COMPANY_ID" IS NULL
                       AND "STG_EBS_CUST_ACCOUNTS"."PARTY_ID" IS NOT NULL
                  THEN 'EBS'
              
                  WHEN "STG_OSC_ACCOUNT"."PARTY_ID" IS NOT NULL
                       AND "STG_HUBSPOT_COMPANIES"."COMPANY_ID" IS NOT NULL
                       AND "STG_EBS_CUST_ACCOUNTS"."PARTY_ID" IS NULL
                  THEN 'OSC, HubSpot'
              
                  WHEN "STG_OSC_ACCOUNT"."PARTY_ID" IS NOT NULL
                       AND "STG_HUBSPOT_COMPANIES"."COMPANY_ID" IS NULL
                       AND "STG_EBS_CUST_ACCOUNTS"."PARTY_ID" IS NOT NULL
                  THEN 'OSC, EBS'
              
                  WHEN "STG_OSC_ACCOUNT"."PARTY_ID" IS NULL
                       AND "STG_HUBSPOT_COMPANIES"."COMPANY_ID" IS NOT NULL
                       AND "STG_EBS_CUST_ACCOUNTS"."PARTY_ID" IS NOT NULL
                  THEN 'HubSpot, EBS'
              
                  WHEN "STG_OSC_ACCOUNT"."PARTY_ID" IS NOT NULL
                       AND "STG_HUBSPOT_COMPANIES"."COMPANY_ID" IS NOT NULL
                       AND "STG_EBS_CUST_ACCOUNTS"."PARTY_ID" IS NOT NULL
                  THEN 'OSC, HubSpot, EBS'
              
                  ELSE NULL
              END
        systemColumnType: None
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STG_ADDRESSES_HUBSPOT: c24c0ed3-36ea-41c5-bfc1-ae66163409b6
          STG_ADDRESSES_OSC: c24c0ed3-36ea-41c5-bfc1-ae66163409b6
          STG_EBS_CUST_ACCOUNTS: 7adca5ad-7edb-466f-a1c5-3b51140bb18f
          STG_HUBSPOT_COMPANIES: a485b708-19e1-449a-bb15-89f3638f951e
          STG_OSC_ACCOUNT: 01b7102b-ee82-491c-a933-a7c409ea5f5e
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: USG_STG_HUBSPOT
            nodeName: STG_HUBSPOT_COMPANIES
          - locationName: USG_STG_MASTER
            nodeName: STG_ADDRESSES
          - locationName: USG_STG_ORACLE_EBS
            nodeName: STG_EBS_CUST_ACCOUNTS
          - locationName: USG_STG_ORACLE_SALES_CLOUD
            nodeName: STG_OSC_ACCOUNT
        join:
          joinCondition: |-
            FROM {{ ref('USG_STG_ORACLE_SALES_CLOUD', 'STG_OSC_ACCOUNT') }} "STG_OSC_ACCOUNT"
            FULL OUTER JOIN {{ ref('USG_STG_HUBSPOT', 'STG_HUBSPOT_COMPANIES') }} "STG_HUBSPOT_COMPANIES"
                ON TRIM("STG_OSC_ACCOUNT"."PARTY_NAME") = TRIM("STG_HUBSPOT_COMPANIES"."COMPANY_NAME")
            FULL OUTER JOIN {{ ref('USG_STG_ORACLE_EBS', 'STG_EBS_CUST_ACCOUNTS') }} "STG_EBS_CUST_ACCOUNTS"
                ON TRIM("STG_OSC_ACCOUNT"."PARTY_NAME") = TRIM("STG_EBS_CUST_ACCOUNTS"."PARTY_NAME")
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_ADDRESSES') }} "STG_ADDRESSES_OSC"
                ON "STG_OSC_ACCOUNT"."LOCATION_ID" = "STG_ADDRESSES_OSC"."OSC_LOCATION_ID"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_ADDRESSES') }} "STG_ADDRESSES_HUBSPOT"
                ON "STG_HUBSPOT_COMPANIES"."COMPANY_ID" = "STG_ADDRESSES_HUBSPOT"."HUBSPOT_COMPANY_ID"
        name: STG_MERGE_ACCOUNTS_DELETE
        noLinkRefs: []
  name: STG_MERGE_ACCOUNTS_DELETE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
