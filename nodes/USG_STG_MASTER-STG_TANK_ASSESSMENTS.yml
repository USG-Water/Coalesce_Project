fileVersion: 1
id: 02ac953e-0373-40b5-81e6-f78a302fec88
name: STG_TANK_ASSESSMENTS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: USG_STG_MASTER
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 90bde71e-7035-4059-9b10-34b98d4cbb0a
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: PROJECT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f258a38f-9af8-49d8-8fae-f4b2eb3c45c6
                stepCounter: c0a0fb27-6505-4e05-a0dc-72d1bb71e433
            transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 97f40601-dc61-42be-b6a3-6261147347c2
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: NUMBER(38,0)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: PROJECT_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 64027107-0fd0-4e95-882e-fb0e0585cb22
                stepCounter: ef8053f7-a305-419c-837c-ae1b0b30f71c
            transform: ""
        systemColumnType: None
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41766c1f-5b83-47e9-9f0a-8eb50ebf4f11
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: ASSESSMENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 45a891dd-c833-4fda-a8d2-9a5004311afe
                stepCounter: ef8053f7-a305-419c-837c-ae1b0b30f71c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98f0dff2-2ec5-4e8a-b716-9d808884db3b
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: ASSESSMENT_INDEX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5b3bb9a2-99cd-4a77-beaa-73b78e9fd6fd
                stepCounter: ef8053f7-a305-419c-837c-ae1b0b30f71c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e658b62-6cd8-4557-87d3-b498bc264e20
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: ASSESSMENT_BY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9572578d-7622-4059-95fd-ae7f7b50c828
                stepCounter: ef8053f7-a305-419c-837c-ae1b0b30f71c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e689f9b-1528-43c3-9556-ae0c2e7768bb
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: INTERIOR_EXTERIOR_INTERIOR_DRY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 284a578a-eab4-45f0-b859-26ab307aa624
                stepCounter: ef8053f7-a305-419c-837c-ae1b0b30f71c
            transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 0b3b0a1b-b923-4eb6-829f-910bf7d357ba
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: VARCHAR(256)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: SECTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f4a86bd5-824a-466d-98f3-d922e3bd25da
                stepCounter: 97195349-6669-4e29-b685-36d06decb525
            transform: ""
        systemColumnType: None
      - appliedColumnTests: {}
        columnReference:
          columnCounter: acb2beeb-7540-4b62-8ede-c4bf11c4d5e8
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: TANK_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 575e8bc4-bb2c-4633-be2c-bb8a25974674
                stepCounter: ef8053f7-a305-419c-837c-ae1b0b30f71c
            transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: ed626a12-f4c7-4064-9ea8-73ce9692022b
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: VARCHAR(256)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: QUESTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8b418213-40a5-4a6d-aaea-792723c631ed
                stepCounter: 97195349-6669-4e29-b685-36d06decb525
            transform: ""
        systemColumnType: None
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9518739-4e12-4f7f-bdab-490cd431ab06
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: SCORE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 39b99702-61dc-4bb9-be28-cfbefed3fa72
                stepCounter: ef8053f7-a305-419c-837c-ae1b0b30f71c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 01203ecd-f108-4550-bb8b-ea43c248dc8c
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: FLOAT
        description: ""
        name: MAX_SCORE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bb73cad5-0e3b-44d5-a8f2-1f0fac2913ba
                stepCounter: 97195349-6669-4e29-b685-36d06decb525
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f34e59ca-0884-43f2-a38b-c506ef0f16d0
          stepCounter: 02ac953e-0373-40b5-81e6-f78a302fec88
        config: {}
        dataType: TIMESTAMP_TZ(9)
        description: ""
        name: ASSESSMENT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f7c901c4-4cbf-450f-b36d-4bc416d6f39d
                stepCounter: ef8053f7-a305-419c-837c-ae1b0b30f71c
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STG_PROJECTS: c0a0fb27-6505-4e05-a0dc-72d1bb71e433
          STG_SHAREPOINT_TAI_SCORING_QUESTIONS: 97195349-6669-4e29-b685-36d06decb525
          STG_SHAREPOINT_TANK_ASSESSMENTS: ef8053f7-a305-419c-837c-ae1b0b30f71c
          STG_TANK_ASSESSMENTS_HISTORICAL: 3c4f63d4-a358-4798-9902-6ef6fdb52e9d
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: USG_STG_MASTER
            nodeName: STG_PROJECTS
          - locationName: USG_STG_MASTER
            nodeName: STG_TANK_ASSESSMENTS_HISTORICAL
          - locationName: USG_STG_SHAREPOINT
            nodeName: STG_SHAREPOINT_TAI_SCORING_QUESTIONS
          - locationName: USG_STG_SHAREPOINT
            nodeName: STG_SHAREPOINT_TANK_ASSESSMENTS
        join:
          joinCondition: |-
            FROM {{ ref('USG_STG_SHAREPOINT', 'STG_SHAREPOINT_TANK_ASSESSMENTS') }} "STG_SHAREPOINT_TANK_ASSESSMENTS"
            LEFT JOIN {{ ref('USG_STG_SHAREPOINT', 'STG_SHAREPOINT_TAI_SCORING_QUESTIONS') }} "STG_SHAREPOINT_TAI_SCORING_QUESTIONS"
                ON "STG_SHAREPOINT_TANK_ASSESSMENTS"."QUESTION_ID" = "STG_SHAREPOINT_TAI_SCORING_QUESTIONS"."QUESTION_ID"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_TANK_ASSESSMENTS_HISTORICAL') }} "STG_TANK_ASSESSMENTS_HISTORICAL"
                ON "STG_SHAREPOINT_TANK_ASSESSMENTS"."ASSESSMENT_ID" = "STG_TANK_ASSESSMENTS_HISTORICAL"."ASSESSMENT_ID"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_PROJECTS') }} "STG_PROJECTS"
                ON "STG_SHAREPOINT_TANK_ASSESSMENTS"."TITLE"::VARCHAR = "STG_PROJECTS"."PROJECT_NUMBER"
            WHERE "STG_TANK_ASSESSMENTS_HISTORICAL"."ASSESSMENT_ID" IS NULL
            QUALIFY
              TO_NUMBER(SPLIT_PART("STG_SHAREPOINT_TANK_ASSESSMENTS"."ASSESSMENT_ID", '-', 3)) =
              MAX(TO_NUMBER(SPLIT_PART("STG_SHAREPOINT_TANK_ASSESSMENTS"."ASSESSMENT_ID", '-', 3)))
                OVER (
                  PARTITION BY
                    SPLIT_PART("STG_SHAREPOINT_TANK_ASSESSMENTS"."ASSESSMENT_ID", '-', 1),
                    SPLIT_PART("STG_SHAREPOINT_TANK_ASSESSMENTS"."ASSESSMENT_ID", '-', 2),
                    SPLIT_PART("STG_SHAREPOINT_TANK_ASSESSMENTS"."ASSESSMENT_ID", '-', 4)
                );
        name: STG_TANK_ASSESSMENTS
        noLinkRefs: []
  name: STG_TANK_ASSESSMENTS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
