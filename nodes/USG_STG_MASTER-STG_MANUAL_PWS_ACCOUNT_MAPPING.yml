fileVersion: 1
id: ae7f732a-24e5-4a14-b910-89f0a1e2034a
name: STG_MANUAL_PWS_ACCOUNT_MAPPING
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: USG_STG_MASTER
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 30c7cf95-c66c-4864-a231-70f15046dfc2
          stepCounter: ae7f732a-24e5-4a14-b910-89f0a1e2034a
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        name: PWSID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7967aa38-c1cf-4513-89c5-d8a91c4241c2
                stepCounter: 65263c5a-0e12-4bf0-96df-ab131d57e5cc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8d0bb952-029d-4671-9acd-c155da83e42c
          stepCounter: ae7f732a-24e5-4a14-b910-89f0a1e2034a
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        name: ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 521c6c00-3ac6-40f1-b2e1-cadf86878159
                stepCounter: 65263c5a-0e12-4bf0-96df-ab131d57e5cc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 55916ebb-49f8-42a3-9f4d-f134ab489d49
          stepCounter: ae7f732a-24e5-4a14-b910-89f0a1e2034a
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        name: WSC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e7948c99-7905-4094-aece-dc4ac49468dd
                stepCounter: 65263c5a-0e12-4bf0-96df-ab131d57e5cc
            transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: b7e60c13-68e3-42a4-8640-8d64ed1e08ea
          stepCounter: ae7f732a-24e5-4a14-b910-89f0a1e2034a
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: STATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              CASE
                  WHEN LENGTH("STG_ADDRESSES"."STATE") > 2 
                       THEN CASE 
                                WHEN LEFT(CAST("MANUAL_PWS_ACCOUNT_MAPPING"."PWSID" AS VARCHAR), 2) RLIKE '^[A-Z]{2}$'
                                THEN LEFT(CAST("MANUAL_PWS_ACCOUNT_MAPPING"."PWSID" AS VARCHAR), 2)
                                ELSE "STG_ADDRESSES"."STATE"
                            END
                  WHEN "STG_ADDRESSES"."STATE" IS NULL
                       THEN CASE 
                                WHEN LEFT(CAST("MANUAL_PWS_ACCOUNT_MAPPING"."PWSID" AS VARCHAR), 2) RLIKE '^[A-Z]{2}$'
                                THEN LEFT(CAST("MANUAL_PWS_ACCOUNT_MAPPING"."PWSID" AS VARCHAR), 2)
                                ELSE NULL
                            END
                  ELSE "STG_ADDRESSES"."STATE"
              END
        systemColumnType: None
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          MANUAL_PWS_ACCOUNT_MAPPING: 65263c5a-0e12-4bf0-96df-ab131d57e5cc
          STG_ADDRESSES: c24c0ed3-36ea-41c5-bfc1-ae66163409b6
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: USG_RAW_MAPPING
            nodeName: MANUAL_PWS_ACCOUNT_MAPPING
          - locationName: USG_STG_MASTER
            nodeName: STG_ADDRESSES
        join:
          joinCondition: |-
            FROM {{ ref('USG_RAW_MAPPING', 'MANUAL_PWS_ACCOUNT_MAPPING') }} "MANUAL_PWS_ACCOUNT_MAPPING"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_ADDRESSES') }} "STG_ADDRESSES"
                ON "MANUAL_PWS_ACCOUNT_MAPPING"."PWSID" = "STG_ADDRESSES"."EPA_PWSID"
            WHERE "MANUAL_PWS_ACCOUNT_MAPPING"."PWSID" IS NOT NULL
            AND "MANUAL_PWS_ACCOUNT_MAPPING"."ACCOUNT" IS NOT NULL
        name: STG_MANUAL_PWS_ACCOUNT_MAPPING
        noLinkRefs: []
  name: STG_MANUAL_PWS_ACCOUNT_MAPPING
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
