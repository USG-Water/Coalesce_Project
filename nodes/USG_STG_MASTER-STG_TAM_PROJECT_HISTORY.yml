fileVersion: 1
id: 4f8a6790-da55-4448-8e0a-546fa52b8507
name: STG_TAM_PROJECT_HISTORY
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: USG_STG_MASTER
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 663d0171-1191-4d45-b3d2-dd3580259fed
          stepCounter: 4f8a6790-da55-4448-8e0a-546fa52b8507
        config: {}
        dataType: VARCHAR
        description: ""
        name: ACCOUNT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f5ab73b6-6f60-493d-a064-f85a946fc4cc
                stepCounter: 71247957-c2ca-4285-b03d-5cb2109869da
            transform: MAX("STG_ASSETS"."ACCOUNT_ID")
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9a01a704-8e96-4dbf-bcc9-17edf8084797
          stepCounter: 4f8a6790-da55-4448-8e0a-546fa52b8507
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: PROJECT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d574aae3-b02b-4c4b-b5fb-ad9e2941c410
                stepCounter: 461b5c3a-6df7-4c0c-ad8d-f8f0506d97b4
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 258d76da-45f7-4f20-a23e-bad9c0df422d
          stepCounter: 4f8a6790-da55-4448-8e0a-546fa52b8507
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: EBS_SHIP_TO_ADDRESS_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0e4f5a41-0a25-41fd-ba3a-0d1e3b4944fd
                stepCounter: 461b5c3a-6df7-4c0c-ad8d-f8f0506d97b4
            transform: MAX("STG_TAM_PROJECT_CUSTOMERS"."EBS_SHIP_TO_ADDRESS_ID")
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a9b14a05-1a5e-469d-8f01-72ff36b166b6
          stepCounter: 4f8a6790-da55-4448-8e0a-546fa52b8507
        config: {}
        dataType: VARCHAR(30)
        description: ""
        name: CONTRACT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eccb477d-2155-4531-8d49-7a1a8e1fde5d
                stepCounter: fba952f9-d30d-4dce-8c6e-1252050cb1c0
            transform: MAX("STG_PROJECT_CLASSES"."CONTRACT_TYPE")
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: d1cdef93-f4c9-42b5-ae67-b0a025b32bf3
          stepCounter: 4f8a6790-da55-4448-8e0a-546fa52b8507
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              MAX(
                  COALESCE(
                      "STG_SERVICE_REQUESTS"."ACTUAL_START_DATE",
                      "STG_SERVICE_REQUESTS"."PLANNED_START_DATE",
                      "STG_SERVICE_REQUESTS"."SCHEDULED_START_DATE",
                      "STG_PROJECTS"."START_DATE"
                  )
              )
        systemColumnType: None
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ae8ff5e8-2006-4c24-8bcc-a02caaf2fcce
          stepCounter: 4f8a6790-da55-4448-8e0a-546fa52b8507
        config: {}
        dataType: DATE
        description: ""
        name: END_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              MAX(
                  COALESCE(
                      "STG_SERVICE_REQUESTS"."ACTUAL_END_DATE",
                      "STG_SERVICE_REQUESTS"."PLANNED_END_DATE",
                      "STG_SERVICE_REQUESTS"."SCHEDULED_END_DATE",
                      "STG_PROJECTS"."COMPLETION_DATE"
                  )
              )
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a7e2f38f-8c39-4d93-b43b-85246ac5ab92
          stepCounter: 4f8a6790-da55-4448-8e0a-546fa52b8507
        config: {}
        dataType: VARCHAR
        description: ""
        name: START_DATE_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              CASE
                  WHEN MAX(COALESCE("STG_SERVICE_REQUESTS"."ACTUAL_START_DATE", "STG_PROJECTS"."START_DATE")) IS NOT NULL THEN 'Actual'
                  WHEN MAX(COALESCE("STG_SERVICE_REQUESTS"."PLANNED_START_DATE", "STG_SERVICE_REQUESTS"."SCHEDULED_START_DATE")) IS NOT NULL THEN 'Planned'
              END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c187b63-8958-4a24-97a5-8cf26e0567e9
          stepCounter: 4f8a6790-da55-4448-8e0a-546fa52b8507
        config: {}
        dataType: VARCHAR
        description: ""
        name: END_DATE_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              CASE
                  WHEN MAX(COALESCE("STG_SERVICE_REQUESTS"."ACTUAL_END_DATE", "STG_PROJECTS"."COMPLETION_DATE")) IS NOT NULL THEN 'Actual'
                  WHEN MAX(COALESCE("STG_SERVICE_REQUESTS"."PLANNED_END_DATE", "STG_SERVICE_REQUESTS"."SCHEDULED_END_DATE")) IS NOT NULL THEN 'Planned'
              END
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STG_ASSETS: 71247957-c2ca-4285-b03d-5cb2109869da
          STG_PROJECTS: c0a0fb27-6505-4e05-a0dc-72d1bb71e433
          STG_PROJECT_CLASSES: fba952f9-d30d-4dce-8c6e-1252050cb1c0
          STG_SERVICE_REQUESTS: 74ab8def-0ae0-4300-9902-c29c43a1c567
          STG_TAM_PROJECT_CUSTOMERS: 461b5c3a-6df7-4c0c-ad8d-f8f0506d97b4
          STG_TASKS: 413cd36f-e28b-4d12-9785-f06a307f8d64
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: USG_STG_MASTER
            nodeName: STG_ASSETS
          - locationName: USG_STG_MASTER
            nodeName: STG_PROJECT_CLASSES
          - locationName: USG_STG_MASTER
            nodeName: STG_PROJECTS
          - locationName: USG_STG_MASTER
            nodeName: STG_SERVICE_REQUESTS
          - locationName: USG_STG_MASTER
            nodeName: STG_TAM_PROJECT_CUSTOMERS
          - locationName: USG_STG_MASTER
            nodeName: STG_TASKS
        join:
          joinCondition: |-
            FROM {{ ref('USG_STG_MASTER', 'STG_TAM_PROJECT_CUSTOMERS') }} "STG_TAM_PROJECT_CUSTOMERS"
            INNER JOIN {{ ref('USG_STG_MASTER', 'STG_ASSETS') }} "STG_ASSETS"
                ON "STG_TAM_PROJECT_CUSTOMERS"."EBS_SHIP_TO_ADDRESS_ID" = "STG_ASSETS"."EBS_CUSTOMER_SITE_ID"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_PROJECT_CLASSES') }} "STG_PROJECT_CLASSES"
                ON "STG_TAM_PROJECT_CUSTOMERS"."PROJECT_ID" = "STG_PROJECT_CLASSES"."PROJECT_ID"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_PROJECTS') }} "STG_PROJECTS"
                ON "STG_TAM_PROJECT_CUSTOMERS"."PROJECT_ID" = "STG_PROJECTS"."PROJECT_ID"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_TASKS') }} "STG_TASKS"
                ON "STG_TAM_PROJECT_CUSTOMERS"."PROJECT_ID" = "STG_TASKS"."PROJECT_ID"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_SERVICE_REQUESTS') }} "STG_SERVICE_REQUESTS"
                ON "STG_TASKS"."TASK_ID" = "STG_SERVICE_REQUESTS"."TASK_ID"
            GROUP BY "STG_TAM_PROJECT_CUSTOMERS"."PROJECT_ID"
        name: STG_TAM_PROJECT_HISTORY
        noLinkRefs: []
  name: STG_TAM_PROJECT_HISTORY
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
