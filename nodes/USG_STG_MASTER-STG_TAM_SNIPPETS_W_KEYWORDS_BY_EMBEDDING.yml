fileVersion: 1
id: df1fa704-22d8-4d34-bbfc-23a397745a43
name: STG_TAM_SNIPPETS_W_KEYWORDS_BY_EMBEDDING
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: USG_STG_MASTER
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96311e0a-7a1d-4bd5-b4cc-fc0f9f016bcd
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: FNC_FIPS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 06fd52d5-ac33-446f-a618-ff9c72fb0608
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: acc52e79-8615-4b0d-ba1b-206825acd28e
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: CITYLITICS_LEAD_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 13bbee2a-bf98-4a23-8202-2984bc9bc5ec
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec34448a-3a29-4d45-b015-9d06f59a526e
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: CL_SNIPPET_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bea2ef3b-8eba-4ddd-b9e9-4c4608fb07cd
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8f20e72d-e9d3-4c2f-b7d6-097f577b800c
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: FNC_SNIPPET_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f29f3d90-c90f-4eb2-9fc6-0210535a423c
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f13d6a44-3a9d-4154-9919-7e9186289b0b
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR
        description: ""
        name: SNIPPET_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0080ee8c-80b3-4889-89c0-223ad73d0741
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4da874b6-70c5-43bd-9484-0fc93c6c24a0
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: FNC_SNIPPET_TOPIC_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 11733e73-828d-4fd0-a102-16bbed4cce56
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f432ae36-e0a9-45f4-9a8d-2a0db1a72b1f
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: CATEGORY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 22ba1db8-5906-4f32-8970-ebeacfa4c7b0
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e72a8d2f-8d6d-4054-a055-fda24dfb673b
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: TOPIC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bcc713f2-0b6d-4bd1-9a48-d511ffd2e4ff
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bacac909-12a7-490b-93c7-446c4c749432
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: KEYWORDS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: af7d17fa-cc1c-43b0-8b58-dd2938b871d3
                stepCounter: 4e3ed600-7c55-4b02-8d9c-0b3711e4f0aa
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7f88830b-5ee1-49c8-b167-0003edd1f3ca
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR
        description: ""
        name: SNIPPET_URL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: de5282bd-5e77-49be-b8e6-12346d8176f8
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1fc9f381-f607-47b2-b419-e746f8ba9d8e
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR
        description: ""
        name: SNIPPET_SUMMARY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 19d8691d-087c-4c2e-96cc-b04f80b6a7c4
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 81874bef-a966-4023-8b94-ccffa3f7d64b
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR
        description: ""
        name: SNIPPET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0fd115c6-a5ea-4349-82e4-f52c33676016
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 482632c1-eaaa-4b16-9ed1-c4105d91a5bf
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR
        description: ""
        name: SNIPPET_NORM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0fd115c6-a5ea-4349-82e4-f52c33676016
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: LOWER(TRIM(REGEXP_REPLACE("STG_TAM_SNIPPETS_CORTEX_EMBED"."SNIPPET", '\\s+', ' ')))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4d700b32-7a7b-4b99-89f4-ac10ad483d92
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VECTOR(FLOAT, 768)
        description: ""
        name: SNIPPET_EMBED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4c7eddf5-3278-4b31-90c2-baa574d4820e
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 294838ec-f5ba-4f12-8c2e-f6f01008affc
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: DATE
        description: ""
        name: TS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 43287b89-eece-40dd-aaa7-9a7e30c1a977
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 168d30e8-6614-45da-bf80-d99bddec4bdd
          stepCounter: df1fa704-22d8-4d34-bbfc-23a397745a43
        config: {}
        dataType: VARCHAR
        description: ""
        name: SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: af2458c7-8daa-410b-8fb9-b05a36d05c19
                stepCounter: 3142233e-288e-41a2-967f-655edfad6274
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STG_TAM_SNIPPETS_CORTEX_EMBED: 3142233e-288e-41a2-967f-655edfad6274
          STG_TAM_SNIPPET_KEYWORD_SCORES: 4e3ed600-7c55-4b02-8d9c-0b3711e4f0aa
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: USG_STG_MASTER
            nodeName: STG_TAM_SNIPPET_KEYWORD_SCORES
          - locationName: USG_STG_MASTER
            nodeName: STG_TAM_SNIPPETS_CORTEX_EMBED
        join:
          joinCondition: |-
            FROM {{ ref('USG_STG_MASTER', 'STG_TAM_SNIPPETS_CORTEX_EMBED') }} "STG_TAM_SNIPPETS_CORTEX_EMBED"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_TAM_SNIPPET_KEYWORD_SCORES') }} "STG_TAM_SNIPPET_KEYWORD_SCORES"
                ON "STG_TAM_SNIPPETS_CORTEX_EMBED"."SNIPPET_ID" = "STG_TAM_SNIPPET_KEYWORD_SCORES"."SNIPPET_ID"
                AND "STG_TAM_SNIPPET_KEYWORD_SCORES"."RN" = 1
                AND "STG_TAM_SNIPPET_KEYWORD_SCORES"."SIMILARITY" >= 0.6
        name: STG_TAM_SNIPPETS_W_KEYWORDS_BY_EMBEDDING
        noLinkRefs: []
  name: STG_TAM_SNIPPETS_W_KEYWORDS_BY_EMBEDDING
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
