fileVersion: 1
id: edf9511e-3167-4ef9-8537-dc88733b9c0c
name: STG_TAM_ASSETS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: USG_STG_MASTER
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0f0ebeee-0c8e-46c3-bd50-9dd3add73d59
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR
        description: ""
        name: ACCOUNT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f5ab73b6-6f60-493d-a064-f85a946fc4cc
                stepCounter: 71247957-c2ca-4285-b03d-5cb2109869da
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 494af107-d62c-4aa8-bb5f-c3c8f3257485
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: EBS_CUSTOMER_SITE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5baddb33-31b4-45e9-a187-dbe35e70bdad
                stepCounter: 71247957-c2ca-4285-b03d-5cb2109869da
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 19fd7024-2f7a-47d6-b6c1-5a0b2d27d7e7
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: TUM_PROJECT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 329480ec-4427-4c7e-bd3d-bc46baad9dd6
                stepCounter: 95871152-b94c-4c95-ad41-198b325aa6bb
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c78799f4-615b-4187-8460-bd49a55a2fce
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: CHURNED_TUM_PROJECT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 91125b97-09d8-44fa-a634-8ac5894c4007
                stepCounter: 188a8b33-8644-4e75-a9a6-cb4ace0b29b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6dfed937-7b0c-42fa-b22a-9db8b6213f5c
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: CHURNED_LAST_BILLING_YEAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 49c238ee-8d44-48d0-bd12-873a9d38283f
                stepCounter: 188a8b33-8644-4e75-a9a6-cb4ace0b29b1
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0958cccb-440d-4c7b-9b4a-cf1caecc7907
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: OSC_OPEN_OPTY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a4cef510-6907-4871-8212-eba91dd53b5c
                stepCounter: edc43f82-57bb-4b33-910d-422d5eac7120
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9baf02f4-ede2-432a-9e89-0ed438e2a7a4
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: PWSID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ebf7ce5-235e-4a3d-b625-de8f1bf7f9ef
                stepCounter: e06a4544-2840-4718-ad43-831b10421819
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f923958e-f363-4596-96d0-9da8e8fea3ba
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: FNC_FIPS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8b632e4d-95cc-47dc-9841-2c6ad6cf34af
                stepCounter: f76bc498-9a03-4e52-95e0-39feab0bb8cc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c59f13e4-b275-4e74-aa53-e1a95f9b40ea
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR
        description: ""
        name: ADDRESS_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dbadba58-d53f-4737-b1b0-d7229f9cf582
                stepCounter: 71247957-c2ca-4285-b03d-5cb2109869da
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 365f0a66-11d9-40c2-943b-854281d870a4
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: ADDRESS_1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5dbf8987-db51-43a0-b1d9-d25587083c86
                stepCounter: f76bc498-9a03-4e52-95e0-39feab0bb8cc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 76349c78-2c12-431d-8150-b876489de84b
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR(16384)
        description: ""
        name: CITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1d090e7c-5de3-446e-bcd7-80529707d28c
                stepCounter: f76bc498-9a03-4e52-95e0-39feab0bb8cc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 744bd7aa-5569-4cc5-91af-32864649a591
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: POSTAL_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8c942cd-115c-42cd-9488-be9a8544dafb
                stepCounter: f76bc498-9a03-4e52-95e0-39feab0bb8cc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6f47eccb-6ca8-4f74-87db-d8897275a526
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: STATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 24098fc6-69d9-4e4d-a485-93a5d3d05957
                stepCounter: f76bc498-9a03-4e52-95e0-39feab0bb8cc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2288a756-afc5-4883-93bc-3fdd88d0053d
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: FLOAT
        description: ""
        name: LATITUDE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 90704328-53cf-45d6-a8fd-f184ed48a7e3
                stepCounter: f76bc498-9a03-4e52-95e0-39feab0bb8cc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e6ea5e94-2184-4ded-945e-1ea2f472238d
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: FLOAT
        description: ""
        name: LONGITUDE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2d70ce1b-415c-4191-807d-e4c13dc5e825
                stepCounter: f76bc498-9a03-4e52-95e0-39feab0bb8cc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 55f49ff5-4892-4be0-ae2a-28ce68f2c66a
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR
        description: ""
        name: POINT_GRANULARITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 673aaef9-9b96-4f63-9912-d1f62503db64
                stepCounter: f76bc498-9a03-4e52-95e0-39feab0bb8cc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 539caf54-f7d5-40c6-b455-8806a4a6bcee
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR
        description: ""
        name: FULL_ADDRESS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: CONCAT_WS(', ', "STG_ADDRESSES"."ADDRESS_1", "STG_ADDRESSES"."CITY", "STG_ADDRESSES"."POSTAL_CODE", "STG_ADDRESSES"."STATE", 'USA')
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 41ab5528-ddc2-4cd1-a000-51c36a6da850
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: MAP_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: "'Asset'"
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 351cf99a-da5c-458f-9075-42565e5bc2ce
          stepCounter: edf9511e-3167-4ef9-8537-dc88733b9c0c
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              CASE
                  WHEN "STG_TUM_CUSTOMERS"."PROJECT_ID" IS NOT NULL THEN 'Active TUM'
                  WHEN "STG_TAM_OPEN_OPPORTUNITIES"."OSC_OPTY_ID" IS NOT NULL THEN 'Active Prospect'
                  WHEN "STG_TUM_CHURNED_CUSTOMERS"."PROJECT_ID" IS NOT NULL THEN 'Churned TUM'
                  ELSE 'Whitespace'
              END
        systemColumnType: None
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STG_ACCOUNTS: e06a4544-2840-4718-ad43-831b10421819
          STG_ADDRESSES: f76bc498-9a03-4e52-95e0-39feab0bb8cc
          STG_ASSETS: 71247957-c2ca-4285-b03d-5cb2109869da
          STG_TAM_OPEN_OPPORTUNITIES: edc43f82-57bb-4b33-910d-422d5eac7120
          STG_TUM_CHURNED_CUSTOMERS: 188a8b33-8644-4e75-a9a6-cb4ace0b29b1
          STG_TUM_CUSTOMERS: 95871152-b94c-4c95-ad41-198b325aa6bb
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: USG_STG_MASTER
            nodeName: STG_ACCOUNTS
          - locationName: USG_STG_MASTER
            nodeName: STG_ADDRESSES
          - locationName: USG_STG_MASTER
            nodeName: STG_ASSETS
          - locationName: USG_STG_MASTER
            nodeName: STG_TAM_OPEN_OPPORTUNITIES
          - locationName: USG_STG_MASTER
            nodeName: STG_TUM_CHURNED_CUSTOMERS
          - locationName: USG_STG_MASTER
            nodeName: STG_TUM_CUSTOMERS
        join:
          joinCondition: |-
            FROM {{ ref('USG_STG_MASTER', 'STG_ASSETS') }} "STG_ASSETS"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_ADDRESSES') }} "STG_ADDRESSES"
                ON "STG_ASSETS"."ADDRESS_ID" = "STG_ADDRESSES"."ADDRESS_ID"
            LEFT JOIN {{ ref('USG_STG_MASTER',  'STG_ACCOUNTS') }} "STG_ACCOUNTS"
                 ON "STG_ASSETS"."ACCOUNT_ID" = "STG_ACCOUNTS"."ACCOUNT_ID"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_TUM_CUSTOMERS') }} "STG_TUM_CUSTOMERS"
                ON "STG_ASSETS"."EBS_CUSTOMER_SITE_ID" = "STG_TUM_CUSTOMERS"."EBS_SHIP_TO_ADDRESS_ID"
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_TUM_CHURNED_CUSTOMERS') }} "STG_TUM_CHURNED_CUSTOMERS"
                ON "STG_ASSETS"."EBS_CUSTOMER_SITE_ID" = "STG_TUM_CHURNED_CUSTOMERS"."EBS_SHIP_TO_ADDRESS_ID"
                AND "STG_TUM_CUSTOMERS"."PROJECT_ID" IS NULL
            LEFT JOIN {{ ref('USG_STG_MASTER', 'STG_TAM_OPEN_OPPORTUNITIES') }} "STG_TAM_OPEN_OPPORTUNITIES"
                ON "STG_ASSETS"."ACCOUNT_ID" = "STG_TAM_OPEN_OPPORTUNITIES"."ACCOUNT_ID"
            WHERE "STG_ADDRESSES"."POINT_GRANULARITY" IS NOT NULL
                   AND NOT (
                        "STG_TUM_CUSTOMERS"."PROJECT_ID" IS NULL
                        AND ("STG_ASSETS"."ASSET_TYPE" IS NULL OR "STG_ASSETS"."ASSET_TYPE" IN ('Other', 'Not Specified', 'Well', 'STP'))
                    )
        name: STG_TAM_ASSETS
        noLinkRefs: []
  name: STG_TAM_ASSETS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
