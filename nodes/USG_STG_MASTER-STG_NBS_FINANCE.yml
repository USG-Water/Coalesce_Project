fileVersion: 1
id: 63699cad-58bc-4c38-bfd8-0d613789006d
name: STG_NBS_FINANCE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: USG_STG_MASTER
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b0abc0c7-5490-40ee-b364-626548f09294
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: NUMBER
        description: ""
        name: PROJECT_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 155b8dc6-d1a0-4b2e-8358-ff74bbd9c289
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: TRY_TO_NUMBER("NBS"."PROJECT_NUMBER")
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3cf8d3dc-3680-41aa-a69f-bd8c4373ac13
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: SALESREP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e15c71f7-206b-4c6c-be47-ad31c69e76cb
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 001da1ef-3006-453e-8a12-5920fc014b26
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: CUSTOMER_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6760e743-3a0e-461b-95f1-c2ce78a21087
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a434ec3f-5fb0-4eba-acc9-b17b75a963ad
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: FLOAT
        description: ""
        name: REGION_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bc38b57f-5171-4421-b867-bffa59a16f2b
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8f99aedb-0c14-4ec1-8afe-cd2938807d28
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: REGION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 98be8f4f-8021-4591-a99c-c95c7467d9f5
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: COALESCE("NBS"."REGION", "NBS"."REGION_1")
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5e26144e-6eea-4740-88c8-673a527e57b2
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: SERVICE_LINE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 35734358-be51-4868-ad32-dc3f3746d2bf
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9489e4b3-9c67-4ad9-bb37-53db9e9f8915
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: PRODUCT_LINE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 950c1f62-b38a-4b56-b586-d2b72de18d08
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4474010d-eab6-4eb7-9d97-884ab75ece13
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: RPT_PRODUCT_FAMILY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea0caad7-3eef-4b68-8d47-d477aed04d30
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ae8aa061-3b66-4289-b589-e715d09cc696
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: RPT_PRODUCT_LINE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8d5d1004-fe41-43e1-abb8-5f7c7131d4b9
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 72d14a98-5906-4471-8d5d-023a221afa2b
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: CONTRACT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea129546-7a6e-4195-8657-9e89b676da4c
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 527aee5d-227b-4cb0-85e9-c3bd618cd2d6
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: TASK_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6c0ec6fe-6eb9-45ab-9bcd-402c00b56d01
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a94a7513-e0a3-4b65-b697-87796cb46a01
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: NUMBER
        description: ""
        name: ORDER_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3d6a556e-e699-4c16-82a0-457ed6a9d86f
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: TRY_TO_NUMBER("NBS"."ORDER_NUMBER")
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d81b0944-2560-40d9-8339-311fe856f83d
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: FLOAT
        description: ""
        name: SALES_PRICE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f1c11e8e-9d13-4445-b4de-71f995c4fbaf
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ROUND("NBS"."SALES_PRICE_SUM", 2)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6fa23273-3e14-482b-adc4-0bbd1fbb01b3
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: DATE
        description: ""
        name: PROJECT_CREATION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 24c0259f-a3fd-4016-b86e-68626b3aea5c
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: |-
              CASE
                  -- Excel numeric dates
                  WHEN TRY_TO_NUMBER("NBS"."PROJECT_CREATION_DATE") IS NOT NULL THEN
                      DATEADD(
                          second,
                          TRY_TO_NUMBER("NBS"."PROJECT_CREATION_DATE") * 86400,
                          '1899-12-30'::timestamp
                      )

                  -- Timestamp strings
                  WHEN TRY_TO_TIMESTAMP("NBS"."PROJECT_CREATION_DATE") IS NOT NULL THEN
                      TRY_TO_TIMESTAMP("NBS"."PROJECT_CREATION_DATE")

                  ELSE NULL
              END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4840ff54-1789-4589-8b9e-1440cf2d7354
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: DATE
        description: ""
        name: PROJECT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 55f0ed5b-1ab3-4c57-b23b-8bfe7dd362e2
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: |-
              CASE
                  -- Excel numeric dates
                  WHEN TRY_TO_NUMBER("NBS"."PROJECT_START_DATE") IS NOT NULL THEN
                      DATEADD(
                          second,
                          TRY_TO_NUMBER("NBS"."PROJECT_START_DATE") * 86400,
                          '1899-12-30'::timestamp
                      )

                  -- Timestamp strings
                  WHEN TRY_TO_TIMESTAMP("NBS"."PROJECT_START_DATE") IS NOT NULL THEN
                      TRY_TO_TIMESTAMP("NBS"."PROJECT_START_DATE")

                  ELSE NULL
              END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 761e331b-7625-4ad9-ae7f-dd5e8fd38ba4
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: DATE
        description: ""
        name: NBS_CREATION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f11ad6ad-6c31-481b-a932-8cfc87d07452
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: |-
              CASE
                  -- Excel numeric dates
                  WHEN TRY_TO_NUMBER("NBS"."NBS_CREATION_DATE") IS NOT NULL THEN
                      DATEADD(
                          second,
                          TRY_TO_NUMBER("NBS"."NBS_CREATION_DATE") * 86400,
                          '1899-12-30'::timestamp
                      )

                  -- Timestamp strings
                  WHEN TRY_TO_TIMESTAMP("NBS"."NBS_CREATION_DATE") IS NOT NULL THEN
                      TRY_TO_TIMESTAMP("NBS"."NBS_CREATION_DATE")

                  ELSE NULL
              END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f0658e81-e381-4767-be8d-efc2f94d1f50
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: DATE
        description: ""
        name: REPORTING_MONTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5b0cdee5-90f3-4683-a2c7-c6bf6da489ba
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: |
              TO_DATE(
                  '01 ' || "NBS"."REPORTING_MONTH",
                  'DD MMMM YY'
              )
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e5382727-b4f7-4fc9-adff-49375cc2c37f
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: FLOAT
        description: ""
        name: REP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 05716d79-0cfc-42fd-8c6f-d8b5cd75df66
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9bb48f35-773e-4daf-bd91-3659ee66df1e
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: FLOAT
        description: ""
        name: UNIQUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: baa8b746-8b7a-4fc3-ad5b-1617a70f4a3b
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: afbe783d-d7c9-400a-a932-b4ea64c9d9c4
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: FLOAT
        description: ""
        name: SMART_SALES_EXTRAP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b9aef5e-8f36-453b-a27d-6043d72cb44a
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a619e9a9-be8c-44a5-8487-ae935c03abe2
          stepCounter: 63699cad-58bc-4c38-bfd8-0d613789006d
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: STL_OTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 040cefd0-8fc4-4a4e-999d-7da42ae36b15
                stepCounter: 400c96d5-69e7-44c6-878a-0464b1771263
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          NBS: 400c96d5-69e7-44c6-878a-0464b1771263
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: USG_RAW_SHARE_POINT_NBS
            nodeName: NBS
        join:
          joinCondition: |-
            FROM {{ ref('USG_RAW_SHARE_POINT_NBS', 'NBS') }} "NBS"
            WHERE YEAR(TO_DATE('01 ' || "NBS"."REPORTING_MONTH", 'DD MMMM YY')) >= 2020
        name: STG_NBS_FINANCE
        noLinkRefs: []
  name: STG_NBS_FINANCE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
