fileVersion: 1
id: af428526-fa91-4432-aecf-5ed886440b93
name: STG_FF_NEXT_YEAR_TAI_CUTOFF_TEST
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: USG_STG_MASTER
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 2284d42c-4db8-4041-b6f1-def3b7c4567f
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: FLOAT
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: TAI_CUTOFF
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: "\"TAI_CUTOFF\".\"TAI_SCORE\""
        systemColumnType: None
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aba1b494-7645-4105-965c-bf89120fd0b4
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: PROJECT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ed0e5276-85c0-42a5-9f0c-89efed3e5c2f
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f3e3a8d1-9bd1-4dd6-ae1c-85b7c186f57d
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: VARCHAR
        description: ""
        name: ACCOUNT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 463e8297-2b02-4e86-b7ca-d86e29dd8d68
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 52650591-4007-4be2-a2e9-a9d9ad20d7e7
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: TASK_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 65d70d24-7113-4645-8f52-1f23ed26ec77
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a05d44ab-a802-4891-98d6-c6262d8b2a43
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: VARCHAR
        description: ""
        name: TASK_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a0b4204f-c717-495f-b2d3-b6407d0b5ecf
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4ed67493-cec6-4d16-875c-30d8ba935e88
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: VARCHAR
        description: ""
        name: INTERIOR_OR_EXTERIOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 47fc0f6f-864f-45c9-856a-65c47332968b
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4235acb9-0f50-4e0f-864d-39f6cf91e451
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: VARCHAR(30)
        description: ""
        name: REGION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d57e7ecc-ae60-46d9-ac56-22235ac94b81
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0373f6ca-7129-4ddb-84b7-cfe77d90e1ba
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: STATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7c7570b4-47b7-44e4-9a2e-220f7dff4079
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bcbede68-a32f-47c5-a03b-397c1396b040
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: VARCHAR(30)
        description: ""
        name: TANK_STYLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bdea62ed-f35b-45dd-8f49-06cc8cfc0fe1
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 59402468-4820-4f44-bdd3-9e1ca8186ebd
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: VARCHAR(30)
        description: ""
        name: TANK_SIZE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9a1a184c-26a8-4128-85d3-1a08813e32c5
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cdb80169-24ab-4222-9ca4-ee49be839fdf
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: VARCHAR(240)
        description: ""
        name: PAINT_CONDITION_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4b06b5dd-f348-4a97-9df6-4d56a51054a4
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 29cfacb9-ff76-4955-88af-0c5a43eb9922
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: NUMBER(38,5)
        description: ""
        name: SQUARE_FOOTAGE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b2e8e0b-d4a9-48e5-bb99-a0fb6f78419e
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7c6b4cf0-d0aa-456e-99b1-6affdd9e01d1
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: FLOAT
        description: ""
        name: TAI_SCORE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0effd9d7-a4f9-477a-9f88-8a0dc3af4db1
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a440c36c-7ae5-4ea6-bc38-a7de1064ed4a
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: NUMBER
        description: ""
        name: ACCOUNT_ASSET_COUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 911472ae-572e-4c1d-9035-331a89f3421e
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 43b4c766-4dad-4c93-8369-ae48eb876b10
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: FLOAT
        description: ""
        name: AVG_BILLINGS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 81b0aba5-2bf8-4a91-9881-b9c81fc1388b
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e3eb2bb-c5a2-43c6-8fb9-bc964738e1f6
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: FLOAT
        description: ""
        name: AVG_ANNUAL_LOG_DEGREDATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0bcacd0d-876f-4a78-9523-3d5019d21ccd
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 56c52480-84e5-4622-8b9d-c31e30009ca1
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: FLOAT
        description: ""
        name: AVG_ANNUAL_PCT_DEGREDATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ce5b18d6-b582-44e4-8d40-664ac9607be1
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9ca065de-7ea2-4772-b4ef-b859f2acfdb2
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: NUMBER(38,2)
        description: ""
        name: COST_BUDGET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7e93a233-4e65-43fe-b61d-96b37efc698d
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f5ed9cb3-7364-4042-9c36-55fed6fcba6c
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: BOOLEAN
        description: ""
        name: COASTAL_TANK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dda13351-5c0a-4234-9e38-73d424ac59d2
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c0a47a59-452d-4892-a1f9-a0b775e2f4ba
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: BOOLEAN
        description: ""
        name: DATE_CONTRACT_OBLIGATION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 71636d87-27e3-4a37-a86d-d71ce3eb259d
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9299fc8e-560c-4d5f-bfbe-8c1f4881bf9b
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: FLOAT
        description: ""
        name: AVG_CYCLE_LENGTH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8b2f5042-bfa8-4ace-89fb-211072f72e8b
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 73ba4bfd-e3bb-4afb-9835-807ef0302f1f
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: NUMBER
        description: ""
        name: YEARS_SINCE_LAST_COMPLETION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bab2a328-947a-449c-839d-0d3b99422aad
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6722845f-b138-45dd-afb5-759e21bbe9df
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: DATE
        description: ""
        name: TAI_ASSESSMENT_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c862ddcf-927b-4372-b175-7b4ac749582f
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 976a9402-8601-4363-a930-f164fcd5021e
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: DATE
        description: ""
        name: START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f0ec9002-8aad-446d-ab3c-4bd1ebf84311
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 16fd0982-3ba0-4a4a-9caa-1e4ad4dee503
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: NUMBER
        description: ""
        name: START_YEAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7b8d9adc-a5bf-4faf-b7f4-37563adb393f
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 60e8475c-8a8a-4ed0-8de5-3d674270c5ee
          stepCounter: af428526-fa91-4432-aecf-5ed886440b93
        config: {}
        dataType: DATE
        description: ""
        name: LAST_COMPLETION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4c353180-9975-4190-a6a9-f9a2d6e4f87a
                stepCounter: 3415b682-4023-40ff-963b-e99731c7becc
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STG_FF_OPEN_CYCLE_TASKS: 3415b682-4023-40ff-963b-e99731c7becc
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: USG_STG_MASTER
            nodeName: STG_FF_OPEN_CYCLE_TASKS
        join:
          joinCondition: |-
            FROM {{ ref('USG_STG_MASTER', 'STG_FF_OPEN_CYCLE_TASKS') }} "STG_FF_OPEN_CYCLE_TASKS"
            CROSS JOIN (
                SELECT 1.5 + (SEQ4() * 0.5) AS TAI_SCORE
                FROM TABLE(GENERATOR(ROWCOUNT => 5))
            ) AS "TAI_CUTOFF"
            CROSS JOIN (
                SELECT MIN(START_YEAR) AS MIN_START_YEAR
                FROM {{ ref('USG_STG_MASTER', 'STG_FF_OPEN_CYCLE_TASKS') }}
            ) AS "MIN_DATE"
            WHERE ("STG_FF_OPEN_CYCLE_TASKS"."TAI_SCORE" <= "TAI_CUTOFF"."TAI_SCORE" OR "STG_FF_OPEN_CYCLE_TASKS"."DATE_CONTRACT_OBLIGATION" = TRUE)
                  AND "STG_FF_OPEN_CYCLE_TASKS"."START_YEAR" = "MIN_DATE"."MIN_START_YEAR"
            ORDER BY "TAI_CUTOFF"."TAI_SCORE"
                     , "STG_FF_OPEN_CYCLE_TASKS"."DATE_CONTRACT_OBLIGATION" DESC
                     , "STG_FF_OPEN_CYCLE_TASKS"."TAI_SCORE"
        name: STG_FF_NEXT_YEAR_TAI_CUTOFF_TEST
        noLinkRefs: []
  name: STG_FF_NEXT_YEAR_TAI_CUTOFF_TEST
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
