fileVersion: 1
id: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
name: STG_NBS_PROJECT_COST_AND_CLASSES
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: USG_STG_MASTER
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5ee370a3-7adc-411a-8e5b-1159ccc3e53c
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        name: PROJECT_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 92fd657c-27d4-4eb6-b1a5-f533470cdeaa
                stepCounter: c0a0fb27-6505-4e05-a0dc-72d1bb71e433
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cdb1854c-033b-4b92-be64-8c88d3a95260
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: PROJECT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f258a38f-9af8-49d8-8fae-f4b2eb3c45c6
                stepCounter: c0a0fb27-6505-4e05-a0dc-72d1bb71e433
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ced522dd-da76-437d-b209-a67a32461e97
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        name: PROJECT_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e55a3fe-0d02-4c90-99e3-a37e27ee0636
                stepCounter: c0a0fb27-6505-4e05-a0dc-72d1bb71e433
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a5a6688e-e9ca-4e6d-aa42-a10f327842ea
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: VARCHAR(30)
        description: ""
        name: CLASS_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7959a14a-943a-404e-8252-07d06b31de38
                stepCounter: 3bf2a259-6cd7-48a9-bf10-d182a143eb96
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da0bfb5c-ed4b-4f17-b12f-54cdec086e4d
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: VARCHAR(30)
        description: ""
        name: REGION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7959a14a-943a-404e-8252-07d06b31de38
                stepCounter: 3bf2a259-6cd7-48a9-bf10-d182a143eb96
            transform: |-
              CASE "STG_EBS_PROJECT_CLASSES"."CLASS_CODE"
                  WHEN '01' THEN 'South'
                  WHEN '02' THEN 'Central'
                  WHEN '03' THEN 'West'
                  WHEN '04' THEN 'North'
                  ELSE "STG_EBS_PROJECT_CLASSES"."CLASS_CODE"
              END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d6bf8d90-2b34-4b5b-82e8-a5c7074d6ca1
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: DATETIME
        description: ""
        name: PROJECT_START_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cbace67a-669b-4c81-8c24-92ed362ba6a6
                stepCounter: c0a0fb27-6505-4e05-a0dc-72d1bb71e433
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eb141ff5-7e49-436d-93aa-2f427aa61a05
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: VARCHAR(240)
        description: ""
        name: SERVICE_LINE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 95aac15b-ff83-435c-ad97-36582bb08bd9
                stepCounter: 62a5d049-6c23-4b9d-a330-9ebc744c0122
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cc4a3b1d-d720-4124-9f80-74dcfd7fdb44
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: VARCHAR(240)
        description: ""
        name: PRODUCT_LINE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c0920a3-0d2c-438e-b7c4-a4b3b8f05a7d
                stepCounter: 62a5d049-6c23-4b9d-a330-9ebc744c0122
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2daebce7-101e-4c96-bbc7-0f9a7c71191e
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: CONTRACT_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6901adbd-de74-4d93-8b8b-627cd720de41
                stepCounter: 62a5d049-6c23-4b9d-a330-9ebc744c0122
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f58eb470-8812-4653-bda6-2f80683f8ee8
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: TASK_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: da7370cc-f5ef-4713-8429-f8c01ff4e1ac
                stepCounter: 62a5d049-6c23-4b9d-a330-9ebc744c0122
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 88a636ee-1b37-43e2-9ac1-5224794a95cf
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: NUMBER(1,0)
        description: ""
        name: EST_SERVICE_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ad59ea13-b91d-4554-a8e9-8761a0e68abb
                stepCounter: 62a5d049-6c23-4b9d-a330-9ebc744c0122
            transform: SUM(COALESCE("STG_EBS_BOOKED_SALES"."ESTIMATED_SERVICE_COST", 0))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f0476f94-56c6-41ed-b0d4-f636a9d1d824
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: NUMBER(13,3)
        description: ""
        name: EST_RAW_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f711c536-85c6-440a-a73d-f31d52a0f4bd
                stepCounter: 62a5d049-6c23-4b9d-a330-9ebc744c0122
            transform: SUM(COALESCE("STG_EBS_BOOKED_SALES"."ESTIMATED_RAW_COST", 0))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d6c62f76-96d5-43b3-8165-93a5b3fc376d
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: NUMBER(12,2)
        description: ""
        name: SALES_PRICE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f8275053-2f2a-4824-b914-3cd6f407822f
                stepCounter: 62a5d049-6c23-4b9d-a330-9ebc744c0122
            transform: SUM(COALESCE("STG_EBS_BOOKED_SALES"."SALES_PRICE", 0))
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8488ed1-1180-49bc-8537-432746e71ab3
          stepCounter: ef1b8082-d9b0-427a-8a5c-479d2ea21f14
        config: {}
        dataType: DATE
        description: ""
        name: CREATION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cee9d17f-3912-4e58-9ee9-ee6e28bca696
                stepCounter: 62a5d049-6c23-4b9d-a330-9ebc744c0122
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STG_EBS_BOOKED_SALES: 62a5d049-6c23-4b9d-a330-9ebc744c0122
          STG_EBS_PROJECT_CLASSES: 3bf2a259-6cd7-48a9-bf10-d182a143eb96
          STG_PROJECTS: c0a0fb27-6505-4e05-a0dc-72d1bb71e433
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: USG_STG_MASTER
            nodeName: STG_PROJECTS
          - locationName: USG_STG_ORACLE_EBS
            nodeName: STG_EBS_BOOKED_SALES
          - locationName: USG_STG_ORACLE_EBS
            nodeName: STG_EBS_PROJECT_CLASSES
        join:
          joinCondition: |-
            FROM {{ ref('USG_STG_MASTER', 'STG_PROJECTS') }} "STG_PROJECTS"
            INNER JOIN {{ ref('USG_STG_ORACLE_EBS', 'STG_EBS_PROJECT_CLASSES') }} "STG_EBS_PROJECT_CLASSES"
                ON "STG_PROJECTS"."PROJECT_ID" = "STG_EBS_PROJECT_CLASSES"."PROJECT_ID"
            LEFT JOIN {{ ref('USG_STG_ORACLE_EBS', 'STG_EBS_BOOKED_SALES') }} "STG_EBS_BOOKED_SALES"
                ON "STG_PROJECTS"."PROJECT_ID" = "STG_EBS_BOOKED_SALES"."PROJECT_ID"
            WHERE "STG_PROJECTS"."PROJECT_NUMBER" IS NOT NULL
            AND "STG_EBS_PROJECT_CLASSES"."CLASS_CATEGORY" = 'REGION CODE'
            AND "STG_EBS_BOOKED_SALES"."PRODUCT_LINE" IS NOT NULL
            AND "STG_EBS_BOOKED_SALES"."PRODUCT_LINE" != 'UNDEFINED'
            AND "STG_EBS_BOOKED_SALES"."TASK_NAME" NOT LIKE 'URMP%'
            GROUP BY "STG_PROJECTS"."NAME"
                     , "STG_PROJECTS"."PROJECT_ID"
                     , "STG_PROJECTS"."PROJECT_NUMBER"
                     , "STG_EBS_PROJECT_CLASSES"."CLASS_CODE"
                     , "STG_EBS_BOOKED_SALES"."SERVICE_LINE"
                     , "STG_EBS_BOOKED_SALES"."PRODUCT_LINE"
                     , "STG_EBS_BOOKED_SALES"."CONTRACT_TYPE"
                     , "STG_EBS_BOOKED_SALES"."TASK_NAME"
                     , "STG_PROJECTS"."START_DATE"
                     , "STG_EBS_BOOKED_SALES"."CREATION_DATE"
        name: STG_NBS_PROJECT_COST_AND_CLASSES
        noLinkRefs: []
  name: STG_NBS_PROJECT_COST_AND_CLASSES
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
